# ???????????????????????????????????????????????????????????????????????????
# NWRS NAVIGATION CONFIGURATION
# ???????????????????????????????????????????????????????????????????????????
#
# This file configures element classification, modal behavior, page switching,
# and shortcut keys for StreamDeck navigation.
#
# CLASSIFY RULE SYNTAX:
# ---------------------
# CLASSIFY: <path_filter> => <properties>
#
# Path Filter Wildcards:
#   * = matches any single path segment
#   ** = matches any number of path segments
#
# Properties:
#   role      = Element type (optional, for documentation)
#   modal     = Whether element is a modal container (optional, default: false)
#   PageName  = StreamDeck page to switch to when element gets focus (optional)
#   KeyName   = Unique key identifier for shortcut (optional)
#   KeyTitle  = Text shown on StreamDeck button (optional)
#   KeyIcon   = Icon file name or path (optional)
#
# CUSTOM PAGE SYNTAX:
# -------------------
# PAGE: <name> => <5x3 JSON array>
#
# Each page is a 5x3 grid (5 rows, 3 columns) of key names.
# Use null for empty button slots.
#
# ???????????????????????????????????????????????????????????????????????????


# ???????????????????????????????????????????????????????????????????????????
# ELEMENT CLASSIFICATIONS (Modal, Page Switching, Shortcuts)
# ???????????????????????????????????????????????????????????????????????????

# ?????????????????????????????????????????????????????????????????????????
# Modal Definitions with Custom Pages
# ?????????????????????????????????????????????????????????????????????????

# Define MainWindow as modal with custom page
# PageName=MainWindow resolves to MainWindow:Navigation (derived page)
CLASSIFY: Window:MainWindow => \
    modal=true; \
    PageName=MainWindow

# Define SelectTrackDialog as modal with custom page
CLASSIFY: ** > *:SelectTrackDialog => \
    role=group; \
    modal=true; \
    PageName=TrackSelection

# Define SelectCarDialog as modal with custom page
CLASSIFY: ** > *:SelectCarDialog => \
    role=group; \
    modal=true; \
    PageName=CarSelection

# ?????????????????????????????????????????????????????????????????????????
# Shortcut Keys with Custom Pages
# ?????????????????????????????????????????????????????????????????????????

# Quick access to "Change Car" button (switches to CarSelection page on activation)
CLASSIFY: Window:MainWindow > ** > (unnamed):ModernButton["Change car"] => \
    role=modernbutton; \
    KeyName=QuickChangeCar; \
    KeyTitle="Car"; \
    KeyIcon=Car; \
    PageName=CarSelection

# Quick access to "Change Track" button (switches to TrackSelection page on activation)
CLASSIFY: Window:MainWindow > ** > (unnamed):ModernButton["Change track"] => \
    role=modernbutton; \
    KeyName=QuickChangeTrack; \
    KeyTitle="Track"; \
    KeyIcon=Track; \
    PageName=TrackSelection

# Quick access to "Go!" button
CLASSIFY: Window:MainWindow > ** > (unnamed):Button["Go!"] => \
    role=button; \
    KeyName=QuickGo; \
    KeyTitle="GO!"; \
    KeyIcon=!GO

# ?????????????????????????????????????????????????????????????????????????
# Page Switching on Focus (No Shortcuts)
# ?????????????????????????????????????????????????????????????????????????

# Switch to UpDown page when mode tabs get focus
CLASSIFY: Window:MainWindow > ** > (unnamed):ListBoxItem["PRACTICE"] => \
    role=listboxitem; \
    PageName=UpDown

CLASSIFY: Window:MainWindow > ** > (unnamed):ListBoxItem["RACE"] => \
    role=listboxitem; \
    PageName=UpDown

CLASSIFY: Window:MainWindow > ** > (unnamed):ListBoxItem["HOTLAP"] => \
    role=listboxitem; \
    PageName=UpDown


# ???????????????????????????????????????????????????????????????????????????
# CUSTOM PAGE DEFINITIONS
# ???????????????????????????????????????????????????????????????????????????

# ?????????????????????????????????????????????????????????????????????????
# Main Navigation Pages
# ?????????????????????????????????????????????????????????????????????????

# MainWindow page - Inherits from Navigation, adds Quick Drive shortcuts
# PageName=MainWindow in CLASSIFY will resolve to this page
# ? NOTE: Multi-line JSON is supported using backslash continuation
PAGE: MainWindow:Navigation => \
[["base","base","base"], \
 ["QuickChangeCar","QuickChangeTrack","QuickGo"], \
 ["base","base","base"], \
 ["base","base","base"], \
 ["base","base","base"]]

# ?????????????????????????????????????????????????????????????????????????
# Dialog-Specific Pages
# ?????????????????????????????????????????????????????????????????????????

# TrackSelection page - Used when SelectTrackDialog is open
# Inherits from Navigation, customizes for track selection
PAGE: TrackSelection:Navigation => \
[["base","base","base"], \
 [null,null,null], \
 [null,"Up",null], \
 ["Left","MouseLeft","Right"], \
 [null,"Down",null]]

# CarSelection page - Used when SelectCarDialog is open
# Inherits from Navigation, customizes for car selection
PAGE: CarSelection:Navigation => \
[["base","base","base"], \
 [null,null,null], \
 [null,"Up",null], \
 ["Left","MouseLeft","Right"], \
 [null,"Down",null]]


# ???????????????????????????????????????????????????????????????????????????
# NOTES
# ???????????????????????????????????????????????????????????????????????????
#
# 1. CLASSIFY Rules Support Multiple Features:
#    - Modal classification (modal=true)
#    - Page switching (PageName=<page>)
#    - Shortcut keys (KeyName, KeyTitle, KeyIcon)
#    - Any combination of the above
#
# 2. Page Name Resolution (Inheritance):
#    - PageName=MainWindow ? Resolves to "MainWindow:Navigation" (if defined)
#    - PageName=Settings   ? Resolves to "Settings" (exact match)
#    - PageName=Navigation ? Resolves to "Navigation" (exact match, built-in)
#    
#    Resolution priority:
#      a) Exact match (e.g., "Settings" page exists)
#      b) Derived page (e.g., "MainWindow:Navigation" where "MainWindow" is requested)
#      c) Not found (used as-is, plugin handles unknown page)
#
# 3. Page Inheritance Syntax (Protocol):
#    - PAGE: PageName:BasePage => [...]
#    - "base" in grid inherits key from BasePage at that position
#    - null overrides inherited key with empty position
#    - KeyName overrides inherited key with specified key
#
# 4. Multi-Line Continuation:
#    - Use backslash (\) at the end of a line to continue to next line
#    - Works for CLASSIFY and PAGE rules
#    - Last line of a rule should NOT have trailing backslash
#    
#    Example:
#      PAGE: MyPage => \
#      [["Key1","Key2","Key3"], \
#       [null,null,null], \
#       [null,null,null], \
#       [null,null,null], \
#       [null,null,null]]
#
# 5. Page Switching Priority:
#    a) Custom page from focused element's CLASSIFY rule (highest)
#    b) Custom page from modal's CLASSIFY rule
#    c) Built-in page selection (UpDown for menus, etc.)
#    d) Navigation page (default)
#
# 6. Built-in Keys (always available):
#    - Back, Up, Down, Left, Right, MouseLeft
#    - WriteModalFilter, WriteElementFilter
#
# 7. Built-in Pages (always available):
#    - Navigation (full 6-direction)
#    - UpDown (vertical only, for menus)
#    - Slider (horizontal only)
#    - DoubleSlider (vertical coarse + horizontal fine)
#    - RoundSlider (all 4 directions for circular controls)
#
# 8. To discover element paths:
#    - Navigate to an element
#    - Press WriteElementFilter on StreamDeck
#    - Check "NWRS Navigation Discovery.txt" in AppData
#
# 9. Example: MainWindow Setup
#    
#    # Modal opens with derived page
#    CLASSIFY: Window:MainWindow => modal=true; PageName=MainWindow
#    PAGE: MainWindow:Navigation => [["base","base","base"],["QuickChangeCar","QuickChangeTrack","QuickGo"],...]
#    
#    Result: When MainWindow opens, PageName=MainWindow resolves to MainWindow:Navigation
#            StreamDeck displays: Back, WriteModalFilter, WriteElementFilter (inherited from Navigation)
#                                 QuickChangeCar, QuickChangeTrack, QuickGo (custom shortcuts)
#
# 10. Path filter examples:
#    Exact match:
#      Window:MainWindow > (unnamed):Button
#    
#    Single wildcard (* = any one segment):
#      Window:MainWindow > * > (unnamed):Button
#    
#    Multi-wildcard (** = any number of segments):
#      Window:MainWindow > ** > (unnamed):Button
#    
#    Mixed:
#      Window:MainWindow > * > ** > (unnamed):Button["Go!"]
#
# 11. Modal + Page + Shortcut Example:
#     # Define a dialog as modal, with custom page, AND a shortcut to open it
#     CLASSIFY: ** > *:SettingsDialog => \
#         role=group; \
#         modal=true; \
#         PageName=Settings; \
#         KeyName=QuickSettings; \
#         KeyTitle="Settings"
#     
#     PAGE: Settings:Navigation => [...]
#
# 12. Icon specifications:
#     - Icon name from Assets/SDIcons folder: "Car", "Track", "Back"
#     - Full file path: "C:\\Icons\\custom.png"
#     - Text-based icon (auto-created): "!GO", "!CAR"
#
# 13. DEBUG Builds:
#     - Configuration parse errors are FATAL (throw exceptions)
#     - This helps discover issues quickly during development
#     - Release builds: Errors are logged but don't crash the app
#
# ???????????????????????????????????????????????????????????????????????????
