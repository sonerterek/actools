# ???????????????????????????????????????????????????????????????????????????
# NWRS NAVIGATION CONFIGURATION
# ???????????????????????????????????????????????????????????????????????????
#
# This file configures element classification, modal behavior, page switching,
# and shortcut keys for StreamDeck navigation.
#
# CLASSIFY RULE SYNTAX:
# ---------------------
# CLASSIFY: <path_filter> => <properties>
#
# Path Filter Wildcards:
#   * = matches any single path segment
#   ** = matches any number of path segments
#
# Properties:
#   role      = Element type (optional, for documentation)
#   modal     = Whether element is a modal container (optional, default: false)
#   PageName  = StreamDeck page to switch to when element gets focus (optional, MUST BE QUOTED)
#   KeyName   = Unique key identifier for shortcut (optional, MUST BE QUOTED)
#   KeyTitle  = Text shown on StreamDeck button (optional)
#   KeyIcon   = Icon file name or path (optional)
#   NoAutoClick = Skip auto-click when shortcut is activated (optional, default: false)
#   TargetType = "Element" or "Group" - what the shortcut targets (optional, default: Element)
#   RequireConfirmation = Require YES/NO confirmation before executing (optional, default: false)
#   ConfirmationMessage = Custom confirmation message (optional, defaults to "Execute {KeyName}")
#
# CUSTOM PAGE SYNTAX:
# -------------------
# PAGE: "<name>" => <5x3 JSON array>
#
# Page name MUST be enclosed in double quotes.
# Each page is a 5x3 grid (5 rows, 3 columns) of key names.
# Use null for empty button slots.
#
# ???????????????????????????????????????????????????????????????????????????


# ???????????????????????????????????????????????????????????????????????????
# ELEMENT CLASSIFICATIONS (Modal, Page Switching, Shortcuts)
# ???????????????????????????????????????????????????????????????????????????

# ?????????????????????????????????????????????????????????????????????????
# Modal Definitions with Custom Pages
# ?????????????????????????????????????????????????????????????????????????

# Define MainWindow as modal with custom page
# PageName=MainWindow resolves to MainWindow:Navigation (derived page)
CLASSIFY: Window:MainWindow => \
    modal=true; \
    PageName="MainWindow"

# Define SelectTrackDialog as modal with custom page
CLASSIFY: ** > *:SelectTrackDialog => \
    role=group; \
    modal=true; \
    PageName="TrackSelection"

# Define SelectCarDialog as modal with custom page
CLASSIFY: ** > *:SelectCarDialog => \
    role=group; \
    modal=true; \
    PageName="CarSelection"

# ?????????????????????????????????????????????????????????????????????????
# Shortcut Keys with Custom Pages
# ????????????????????????????????????????????????????????????????????????

# Quick access to "Change Car" button (switches to CarSelection page on activation)
CLASSIFY: Window:MainWindow > ** > (unnamed):ModernButton["Change car"] => \
    role=modernbutton; \
    KeyName="QuickChangeCar"; \
    KeyTitle="Car"; \
    KeyIcon=Car; \
    PageName="CarSelection"
# Note: Will auto-click (default) - pressing QuickChangeCar opens the car selection dialog

# Quick access to "Change Track" button (switches to TrackSelection page on activation)
CLASSIFY: Window:MainWindow > ** > (unnamed):ModernButton["Change track"] => \
    role=modernbutton; \
    KeyName="QuickChangeTrack"; \
    KeyTitle="Track"; \
    KeyIcon=Track; \
    PageName="TrackSelection"
# Note: Will auto-click (default) - pressing QuickChangeTrack opens the track selection dialog

# Quick access to "Go!" button
CLASSIFY: Window:MainWindow > ** > (unnamed):Button["Go!"] => \
    role=button; \
    KeyName="QuickGo"; \
    KeyTitle="GO!"; \
    KeyIcon=!GO; \
    RequireConfirmation=true; \
    ConfirmationMessage="Launch Simulator"
# Note: RequireConfirmation=true shows confirmation page before launching

# ?????????????????????????????????????????????????????????????????????????
# Page Switching on Focus (No Shortcuts)
# ????????????????????????????????????????????????????????????????????????

# Switch to UpDown page when mode tabs get focus
CLASSIFY: Window:MainWindow > ** > (unnamed):ListBoxItem["PRACTICE"] => \
    role=listboxitem; \
    PageName="UpDown"
# Note: No KeyName = no shortcut, just page switching on focus

CLASSIFY: Window:MainWindow > ** > (unnamed):ListBoxItem["RACE"] => \
    role=listboxitem; \
    PageName="UpDown"

CLASSIFY: Window:MainWindow > ** > (unnamed):ListBoxItem["HOTLAP"] => \
    role=listboxitem; \
    PageName="UpDown"


# ???????????????????????????????????????????????????????????????????????????
# CUSTOM PAGE DEFINITIONS
# ???????????????????????????????????????????????????????????????????????????

# ?????????????????????????????????????????????????????????????????????????
# Main Navigation Pages
# ????????????????????????????????????????????????????????????????????????

# MainWindow page - Inherits from Navigation, adds Quick Drive shortcuts
# PageName="MainWindow" in CLASSIFY will resolve to this page
# ? NOTE: Multi-line JSON is supported using backslash continuation
PAGE: "MainWindow:Navigation" => \
[["base","base","base"], \
 ["QuickChangeCar","QuickChangeTrack","QuickGo"], \
 ["base","base","base"], \
 ["base","base","base"], \
 ["base","base","base"]]

# ?????????????????????????????????????????????????????????????????????????
# Dialog-Specific Pages (with ListBoxItem shortcuts)
# ????????????????????????????????????????????????????????????????????????

# TrackSelection page - Used when SelectTrackDialog is open
# Inherits from Navigation, customizes for track selection
# Includes shortcuts to filter tabs (NoAutoClick=true to avoid selection)
#
# Example shortcuts for SelectTrackDialog:
# CLASSIFY: ** > *:SelectTrackDialog > ** > (unnamed):ListBoxItem["COUNTRIES"] => \
#     KeyName="TrackCountries"; \
#     KeyTitle="Countries"; \
#     NoAutoClick=true
# Note: NoAutoClick=true prevents clicking the ListBoxItem (which would select it)
#       We just want to focus it for navigation
PAGE: "TrackSelection:Navigation" => \
[["base","base","base"], \
 [null,null,null], \
 [null,"Up",null], \
 ["Left","MouseLeft","Right"], \
 [null,"Down",null]]

# CarSelection page - Used when SelectCarDialog is open
# Inherits from Navigation, customizes for car selection
PAGE: "CarSelection:Navigation" => \
[["base","base","base"], \
 [null,null,null], \
 [null,"Up",null], \
 ["Left","MouseLeft","Right"], \
 [null,"Down",null]]


# ???????????????????????????????????????????????????????????????????????????
# NOTES
# ???????????????????????????????????????????????????????????????????????????
#
# 1. CLASSIFY Rules Support Multiple Features:
#    - Modal classification (modal=true)
#    - Page switching (PageName=<page>)
#    - Shortcut keys (KeyName, KeyTitle, KeyIcon)
#    - Any combination of the above
#
# 2. Page Name Resolution (Inheritance):
#    - PageName=MainWindow ? Resolves to "MainWindow:Navigation" (if defined)
#    - PageName=Settings   ? Resolves to "Settings" (exact match)
#    - PageName=Navigation ? Resolves to "Navigation" (exact match, built-in)
#    
#    Resolution priority:
#      a) Exact match (e.g., "Settings" page exists)
#      b) Derived page (e.g., "MainWindow:Navigation" where "MainWindow" is requested)
#      c) Not found (used as-is, plugin handles unknown page)
#
# 3. Page Inheritance Syntax (Protocol):
#    - PAGE: PageName:BasePage => [...]
#    - "base" in grid inherits key from BasePage at that position
#    - null overrides inherited key with empty position
#    - KeyName overrides inherited key with specified key
#
# 4. Multi-Line Continuation:
#    - Use backslash (\) at the end of a line to continue to next line
#    - Works for CLASSIFY and PAGE rules
#    - Last line of a rule should NOT have trailing backslash
#    
#    Example:
#      PAGE: MyPage => \
#      [["Key1","Key2","Key3"], \
#       [null,null,null], \
#       [null,null,null], \
#       [null,null,null], \
#       [null,null,null]]
#
# 5. Page Switching Priority:
#    a) Custom page from focused element's CLASSIFY rule (highest)
#    b) Custom page from modal's CLASSIFY rule
#    c) Built-in page selection (UpDown for menus, etc.)
#    d) Navigation page (default)
#
# 6. Built-in Keys (always available):
#    - Back, Up, Down, Left, Right, MouseLeft
#    - WriteModalFilter, WriteElementFilter
#
# 7. Built-in Pages (always available):
#    - Navigation (full 6-direction)
#    - UpDown (vertical only, for menus)
#    - Slider (horizontal only)
#    - DoubleSlider (vertical coarse + horizontal fine)
#    - RoundSlider (all 4 directions for circular controls)
#
# 8. To discover element paths:
#    - Navigate to an element
#    - Press WriteElementFilter on StreamDeck
#    - Check "NWRS Navigation Discovery.txt" in AppData
#
# 9. Example: MainWindow Setup
#    
#    # Modal opens with derived page
#    CLASSIFY: Window:MainWindow => modal=true; PageName=MainWindow
#    PAGE: MainWindow:Navigation => [["base","base","base"],["QuickChangeCar","QuickChangeTrack","QuickGo"],...]
#    
#    Result: When MainWindow opens, PageName=MainWindow resolves to MainWindow:Navigation
#            StreamDeck displays: Back, WriteModalFilter, WriteElementFilter (inherited from Navigation)
#                                 QuickChangeCar, QuickChangeTrack, QuickGo (custom shortcuts)
#
# 10. Path filter examples:
#    Exact match:
#      Window:MainWindow > (unnamed):Button
#    
#    Single wildcard (* = any one segment):
#      Window:MainWindow > * > (unnamed):Button
#    
#    Multi-wildcard (** = any number of segments):
#      Window:MainWindow > ** > (unnamed):Button
#    
#    Mixed:
#      Window:MainWindow > * > ** > (unnamed):Button["Go!"]
#
# 11. Modal + Page + Shortcut Example:
#     # Define a dialog as modal, with custom page, AND a shortcut to open it
#     CLASSIFY: ** > *:SettingsDialog => \
#         role=group; \
#         modal=true; \
#         PageName="Settings"; \
#         KeyName="QuickSettings"; \
#         KeyTitle="Settings"
#     
#     PAGE: "Settings:Navigation" => [...]
#
# 12. Icon specifications:
#     - Icon name from Assets/SDIcons folder: "Car", "Track", "Back"
#     - Full file path: "C:\\Icons\\custom.png"
#     - Text-based icon (auto-created): "!GO", "!CAR"
#
# 13. DEBUG Builds:
#     - Configuration parse errors are FATAL (throw exceptions)
#     - This helps discover issues quickly during development
#     - Release builds: Errors are logged but don't crash the app
#
# 14. Auto-Click Behavior:
#     By default, shortcut keys will focus AND automatically click the target element.
#     This is ideal for buttons where the primary action is to activate them.
#     
#     For elements where clicking has unwanted side effects (e.g., ListBoxItems),
#     use NoAutoClick=true to focus without clicking.
#     
#     Examples:
#       # Button - Will auto-click (default behavior)
#       CLASSIFY: ** > (unnamed):Button["OK"] => \
#           KeyName="DialogOK"; \
#           KeyTitle="OK"
#       
#       # ListBoxItem - Will NOT auto-click (explicit opt-out)
#       CLASSIFY: ** > (unnamed):ListBoxItem["Option1"] => \
#           KeyName="Option1"; \
#           KeyTitle="Opt1"; \
#           NoAutoClick=true
#     
#     Timing:
#       Auto-click happens immediately after focus is established using
#       DispatcherPriority.Input to ensure the element is fully focused.
#
# 15. Confirmation System:
#     For critical operations (like launching the simulator or deleting content),
#     you can require explicit YES/NO confirmation before execution.
#     
#     Properties:
#       RequireConfirmation=true    - Shows confirmation page before execution
#       ConfirmationMessage="..."   - Custom message (optional)
#     
#     Example - Launch simulator with confirmation:
#       CLASSIFY: ** > (unnamed):Button["Go!"] => \
#           KeyName="QuickGo"; \
#           KeyTitle="GO!"; \
#           RequireConfirmation=true; \
#           ConfirmationMessage="Launch Simulator"
#     
#     Example - Delete with confirmation:
#       CLASSIFY: ** > (unnamed):Button["Delete"] => \
#           KeyName="DeleteCar"; \
#           KeyTitle="Delete"; \
#           RequireConfirmation=true; \
#           ConfirmationMessage="Delete Car"
#     
#     Example - Default message:
#       CLASSIFY: ** > (unnamed):Button["Clear"] => \
#           KeyName="ClearAll"; \
#           RequireConfirmation=true
#       # Message will be "Execute ClearAll"
#     
#     Behavior:
#       1. User presses shortcut key on StreamDeck
#       2. StreamDeck switches to "Confirm" page showing YES and NO buttons
#       3. User presses YES ? action executes
#       4. User presses NO  ? returns to previous page, no action
#       5. Page history automatically restored after confirmation
#     
#     Built-in Confirmations:
#       - Back button on MainWindow (exit application) - always confirmed
#       - Any shortcut with RequireConfirmation=true
#
# ???????????????????????????????????????????????????????????????????????????
